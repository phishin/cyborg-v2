<script setup>import { computed, ref, onMounted, onBeforeUnmount, watch } from 'vue';import { useLogoStore } from '~/stores/logoStores';import GenerateLogoLoading from "./GenerateLogoLoading.vue";import LogoBuilder from "./LogoBuilder/LogoBuilder.vue";import { useRoute } from 'vue-router'import SaveLogoModal from "~/components/CreationFlow/SaveLogoModal.vue";// Use the Pinia storeconst logoStore = useLogoStore();const route  = useRoute();// Bind global state via computed properties from the store.const prePopulatedBusinessName = computed(() => logoStore.companyName || '');const selectedIndustry = computed({  get: () => logoStore.selectedIndustry,  set: (val) => { logoStore.selectedIndustry = val; }});const selectedLogoStyle = computed({  get: () => logoStore.selectedLogoStyle,  set: (val) => { logoStore.selectedLogoStyle = val; }});const fullBusinessName = computed({  get: () => logoStore.fullBusinessName,  set: (val) => { logoStore.fullBusinessName = val; }});const businessNameInitials = computed({  get: () => logoStore.businessNameInitials,  set: (val) => { logoStore.businessNameInitials = val; }});const selectedSuffix = computed({  get: () => logoStore.selectedSuffix,  set: (val) => { logoStore.selectedSuffix = val; }});const businessCategory = computed({  get: () => logoStore.businessCategory,  set: (val) => { logoStore.businessCategory = val; }});const sloganOrTagline = computed({  get: () => logoStore.sloganOrTagline,  set: (val) => { logoStore.sloganOrTagline = val; }});const preferredSymbolsOrStyles = computed({  get: () => logoStore.preferredSymbolsOrStyles,  set: (val) => { logoStore.preferredSymbolsOrStyles = val; }});const selectedColorStyles = computed({  get: () => logoStore.selectedColorStyles,  set: (val) => { logoStore.selectedColorStyles = val; }});// Bind the loading flag from the storeconst startGenerationLogo = computed(() => logoStore.logoGenerationLoading);// Local state for logo builder active if needed.const logoBuilderActive = computed(() => logoStore.logoBuilder);// Ensure we show the loader whenever we're between steps and the builder// has not mounted yet (e.g., creationStep is set to 0 while logos are// being generated or if the step counter drifts outside the flow range// on mobile devices).const shouldShowLoader = computed(() => {  const step = logoStore.creationStep ?? 0;  const builderReady = logoBuilderActive.value;  // Show loader while generating or anytime the builder isn't ready and  // the step index is outside the visible steps (protects against  // off-by-one states that can leave a blank screen).  return (      startGenerationLogo.value || (!builderReady && (step <= 0 || step >= 7))  );});// As a safeguard for mobile devices where the builder mount might be delayed,// ensure the loader never persists longer than a few seconds.const loaderTimeoutId = ref(null);watch(    shouldShowLoader,    (visible) => {      if (visible) {        clearTimeout(loaderTimeoutId.value);        loaderTimeoutId.value = setTimeout(() => {          logoStore.logoGenerationLoading = false;          logoStore.logoBuilder = true;        }, 5000);      } else {        clearTimeout(loaderTimeoutId.value);      }    },    { immediate: true });// Calculate progress based on creationStep (assumes 7 steps)const progressStatus = computed(() => (logoStore.creationStep / 7) * 100);const scrollToTop = () => {  window.scrollTo({ top: 0, behavior: "smooth" });};const disableBackButton = () => {  history.pushState(null, document.title, window.location.href);};const showCheckoutModal = ref(false);onMounted(() => {  logoStore.creationStep = 1;  logoStore.createMyLogoIsActive = true;  logoStore.activateCreateMyLogo();  // if the URL is /create-my-logo?success=true  if (route.query.success === 'true') {    // force the builder on    logoStore.createMyLogoIsActive = true;    logoStore.logoBuilder = true;    // optionally jump ahead a step    logoStore.creationStep = 0;    showCheckoutModal.value = true;  }  // If a company name exists, set default values.  if (logoStore.companyName) {    selectedLogoStyle.value = 'Full Business Name';    fullBusinessName.value = logoStore.companyName;  }  window.addEventListener('popstate', disableBackButton);});onBeforeUnmount(() => {  window.removeEventListener('popstate', disableBackButton);  clearTimeout(loaderTimeoutId.value);});</script><template>  <div class="cyborg-creation w-full relative">    <!-- Progress bar -->    <div class="progress-bar fixed block top-[73px] md:top-[75px] lg:top-[95px] left-0 right-0 h-[4px] md:h-[5px] w-full border-t-[2px] md:border-t-[5px] border-t-neutral-200 z-[5]">      <div :style="{ width: progressStatus + '%', maxWidth: progressStatus + '%' }" class="progress-bar-line z-20 bg-brand-200 h-full transition-all duration-500 absolute w-full left-0 right-0 top-[-2px] min-h-full bottom-auto md:h-[5px] md:top-[-5px]"></div>    </div>    <!-- Step Components -->    <transition-group name="fadeUp" appear @before-enter="scrollToTop">      <CreationFlowStep1          v-if="logoStore.creationStep === 1"          :key="logoStore.creationStep"          :selectedIndustry="selectedIndustry"          @selectIndustry="(ind) => { selectedIndustry = ind; }"          :fullBusinessName="logoStore.companyName"      />      <CreationFlowStep2          v-if="logoStore.creationStep === 2"          :key="logoStore.creationStep"          :sloganOrTagline="sloganOrTagline"          @sloganOrTagline="(val) => { sloganOrTagline = val; }"          :preferredSymbolsOrStyles="preferredSymbolsOrStyles"          @preferredSymbolsOrStyles="(val) => { preferredSymbolsOrStyles = val; }"          :selectedColorStyles="selectedColorStyles"          @selectedColorStyles="(val) => { selectedColorStyles = val; }"          @updateFields="(fields) => {            selectedIndustry = fields.selectedIndustry;            selectedLogoStyle = fields.selectedLogoStyle;            fullBusinessName = fields.fullBusinessName;            businessNameInitials = fields.businessNameInitials;            selectedSuffix = fields.selectedSuffix;            businessCategory = fields.businessCategory;            selectedColorStyles = fields.selectedColorStyles;          }"      />      <CreationFlowStep3          v-if="logoStore.creationStep === 3"          :key="logoStore.creationStep"          :sloganOrTagline="sloganOrTagline"          @sloganOrTagline="(val) => { sloganOrTagline = val; }"          :preferredSymbolsOrStyles="preferredSymbolsOrStyles"          @preferredSymbolsOrStyles="(val) => { preferredSymbolsOrStyles = val; }"          :selectedColorStyles="selectedColorStyles"          @selectedColorStyles="(val) => { selectedColorStyles = val; }"          @updateFields="(fields) => {            selectedIndustry = fields.selectedIndustry;            selectedLogoStyle = fields.selectedLogoStyle;            fullBusinessName = fields.fullBusinessName;            businessNameInitials = fields.businessNameInitials;            selectedSuffix = fields.selectedSuffix;            businessCategory = fields.businessCategory;            selectedColorStyles = fields.selectedColorStyles;          }"      />      <CreationFlowStep4          v-if="logoStore.creationStep === 4"          :key="logoStore.creationStep"      />      <CreationFlowStep5          v-if="logoStore.creationStep === 5"          :key="logoStore.creationStep"      />      <!--      <CreationFlowStep6-->      <!--          v-if="logoStore.creationStep === 6"-->      <!--          :key="logoStore.creationStep"-->      <!--      />-->      <CreationFlowStep7          v-if="logoStore.creationStep === 6"          :key="logoStore.creationStep"      />    </transition-group>    <transition>      <generate-logo-loading v-if="shouldShowLoader" />    </transition>    <transition>      <logo-builder v-if="logoBuilderActive" />    </transition>    <transition name="fadeUp">      <checkout-complete-modal v-if="showCheckoutModal" />    </transition>  </div></template><style lang="scss">.creation-step .step-content {  padding-bottom: 50vh;  @media only screen and (min-width: 1024px) {    padding-bottom: 100px;  }}</style><style scoped lang="scss">.fadeUp-enter-active, .fadeUp-leave-active {  transition: opacity 0.5s ease, transform 0.5s ease;}.fadeUp-enter-from {  opacity: 0;  transform: translateY(30px);}.fadeUp-enter-to {  opacity: 1;  transform: translateY(0);}.fadeUp-leave-from {  opacity: 1;  transform: translateY(0);}.fadeUp-leave-to {  opacity: 0;  transform: translateY(-30px);}.cyborg-creation {  input {    transition: .25s all;    -webkit-transition: .25s all;    &:focus, &:focus-visible, &:active {      border: 3px solid #00A5FD;      transition: .25s all;      -webkit-transition: .25s all;      outline: 3px solid #00A5FD;    }  }}</style>