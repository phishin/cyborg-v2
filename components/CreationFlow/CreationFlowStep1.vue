<script setup>import { ref, computed, watch, onMounted, onUnmounted, inject } from "vue";import FrequentlyAskedQuestions from "../homepage/FrequentlyAskedQuestions.vue";import ContactSupportForm from "../homepage/ContactSupportForm.vue";import Fuse from "fuse.js";import industryData from "./all-industries.json";const props = defineProps({  selectedIndustry: Object,});// set emitsconst emit = defineEmits([  "updateProgress",  "selectIndustry",  "advanceStep",  "previousStep",]);// Inject the global stateconst globalCreationState = inject('globalCreationState');// Stateconst selectedIndustry = ref(props.selectedIndustry || null);const query = ref(props.selectedIndustry?.name || ""); // Prepopulate query from selectedIndustryconst industries = ref(industryData);const results = ref([]);const showDropdown = ref(false);const highlightedIndex = ref(-1); // For keyboard navigation// Fuse.js for searchconst fuse = new Fuse(industries.value, {  keys: ["name"],  threshold: 0.3,});// Search logicconst search = () => {  const queryValue = query.value.trim();  if (queryValue) {    results.value = fuse.search(queryValue).map((result) => result.item);    // Clear selection if no exact match    if (!industries.value.some((industry) => industry.name.toLowerCase() === queryValue.toLowerCase())) {      selectedIndustry.value = null;      emit("selectIndustry", null);    }  } else {    results.value = industries.value; // Show all industries when input is empty    selectedIndustry.value = null; // Clear selection    emit("selectIndustry", null);  }};// Select an industryconst selectIndustry = (industry) => {  selectedIndustry.value = industry; // Save the full object  query.value = industry.name; // Update the input field with the name  emit("selectIndustry", industry); // Emit the full object to the parent  showDropdown.value = false; // Hide the dropdown};const focusedInputField = ref(false); // Track the focused state of the input// Handle focus eventconst handleFocus = () => {  focusedInputField.value = true; // Set focused to true when input is focused  showDropdown.value = true; // Show dropdown  search(); // Populate dropdown results};const handleBlur = () => {  focusedInputField.value = false;  setTimeout(() => {    showDropdown.value = false; // Delay to allow mousedown selection  }, 200);};const isFieldPopulated = computed(() => query.value.trim().length > 0);// Ensure dropdown hides only when losing focusconst hideDropdown = () => {  setTimeout(() => {    showDropdown.value = false;  }, 200); // Delay to allow selection on mousedown};const isValidSelection = computed(() =>    industries.value.some((industry) => industry.name.toLowerCase() === query.value.toLowerCase()));// Keyboard navigationconst handleKeyDown = (event) => {  if (!showDropdown.value || results.value.length === 0) return;  if (event.key === "ArrowDown") {    highlightedIndex.value = (highlightedIndex.value + 1) % results.value.length;  } else if (event.key === "ArrowUp") {    highlightedIndex.value = (highlightedIndex.value - 1 + results.value.length) % results.value.length;  } else if (event.key === "Enter" && highlightedIndex.value >= 0) {    selectIndustry(results.value[highlightedIndex.value]); // Select highlighted item  }};/* advance and back steps */const advanceCreationStep = () => {  globalCreationState.creationStep = 7; // Set the step to 7  emit('advanceStep');  // emit('advanceStep'); //};const previousCreationStep = () => {  emit('previousStep'); //};const progressStatus = ref(0);const updateProgress = () => {  progressStatus.value = (globalCreationState.creationStep / 7) * 100;};// Watch for changes to the selectedIndustry propwatch(    () => props.selectedIndustry,    (newIndustry) => {      selectedIndustry.value = newIndustry || null;      query.value = newIndustry?.name || ""; // Update input field    });onMounted(() => {  globalCreationState.creationStep = 1; // Initialize step  query.value = props.selectedIndustry?.name || "";  results.value = industries; // Show all results initially  window.addEventListener("keydown", handleKeyDown);});onUnmounted(() => {  window.removeEventListener("keydown", handleKeyDown);});</script><template>  <section class="creation-step step-1 w-full relative flex flex-col justify-start items-start font-primary mt-[69px] md:mt-[80px] lg:mt-[95px]">    <div class="creation-flow-content w-full h-full relative flex flex-col justify-start items-start">      <!-- Top Prev/Next Buttons on Desktop -->      <div class="top-desktop-buttons relative flex-row justify-between hidden lg:flex pt-[66px] mx-auto w-[90%] site-container">        <!-- Previous step  -->        <a href="/"           class="previous-step-button flex flex-row gap-[12px] py-[25px] px-[24px] max-w-fit border-[4px] border-black uppercase font-black text-[18px] leading-[2px] tracking-[1px] text-neutral-700 items-center h-[68px] transition transition-fast hover:bg-black hover:text-white group">          <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">            <path class="group-hover:fill-white transition transition-fast" fill-rule="evenodd" clip-rule="evenodd"                  d="M6.65829 11.4917C6.20268 11.9473 5.46399 11.9473 5.00838 11.4917L0.341709 6.82504C-0.113903 6.36943 -0.113903 5.63074 0.341709 5.17512L5.00838 0.508457C5.46399 0.052845 6.20268 0.052845 6.65829 0.508457C7.1139 0.964069 7.1139 1.70276 6.65829 2.15837L3.98325 4.83342L12.8333 4.83341C13.4777 4.83341 14 5.35575 14 6.00008C14 6.64441 13.4777 7.16675 12.8333 7.16675H3.98325L6.65829 9.84179C7.1139 10.2974 7.1139 11.0361 6.65829 11.4917Z"                  fill="#1F2937"/>          </svg>          Back One Step        </a>        <!-- Next step  -->        <button            @click="advanceCreationStep"            class="next-step-button flex flex-row gap-[12px] py-[25px] px-[24px] max-w-fit uppercase font-black text-[18px] leading-[1] tracking-[2px] text-white bg-brand-200 items-center h-[68px] transition transition-fast"            :class="isValidSelection ? 'opacity-100 pointer-events-auto' : 'opacity-50 pointer-events-none'">          Continue          <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">            <path fill-rule="evenodd" clip-rule="evenodd"                  d="M7.34171 0.508457C7.79732 0.0528452 8.53601 0.0528451 8.99162 0.508457L13.6583 5.17512C14.1139 5.63074 14.1139 6.36943 13.6583 6.82504L8.99162 11.4917C8.53601 11.9473 7.79732 11.9473 7.34171 11.4917C6.8861 11.0361 6.8861 10.2974 7.34171 9.84179L10.0168 7.16675L1.16667 7.16675C0.522335 7.16675 -2.81646e-08 6.64441 0 6.00008C2.81647e-08 5.35575 0.522335 4.83342 1.16667 4.83342H10.0168L7.34171 2.15837C6.8861 1.70276 6.8861 0.964069 7.34171 0.508457Z"                  fill="white"/>          </svg>        </button>      </div>      <!-- Step One Content -->      <div class="step-content site-container relative w-full">        <div class="top-step-titles bg-white/90 w-full pb-[15px] pt-[35px] lg:pt-[64px] relative top-0 z-[2]">          <h1 class="block relative text-black font-bold text-[20px] md:text-[26px] lg:text-[32px] leading-[1.2]"> Select your industry</h1>          <h2 class="block relative text-black font-normal text-[18px] md:text-[20px] lg:text-[24px] pt-[20px] leading-[1.35]">            This will help create a more custom look for your industry.          </h2>        </div>        <!-- Industry Selection -->        <div class="search-industry relative w-full mt-[24px] md:mt-[35px] lg:mt-[50px] mb-auto">          <div class="search-industry-input-field w-full relative block" :class="{ focused: focusedInputField || isValidSelection || isFieldPopulated }">            <label for="search-industry" class="absolute top-[22px] left-[18px] text-[12px] text-black font-normal transition transition-fast">              Select Specialty (e.g., Plumbing, Electrical)            </label>            <input                id="search-industry"                type="text"                v-model="query"                @input="search"                @focus="handleFocus"                @blur="handleBlur"                :class="['focused', { focusedInputField }]"                class="industry-search-input border-[3px] border-neutral-200 block w-full text-black font-medium min-h-[64px] max-h-[64px] px-[18px] transition transition-fast focus:border-brand-electric-blue active:border-brand-electric-blue"            />          </div>          <!-- Dropdown for search results -->          <ul v-if="showDropdown && results.length" class="dropdown-list absolute w-full border border-neutral-200 bg-white max-h-[200px] md:max-h-[290px] lg:max-h-[385px] overflow-y-auto z-10">            <li                v-for="(industry, index) in results"                :key="industry.id"                @mousedown.prevent="selectIndustry(industry)"                :class="['dropdown-item text-black text-[16px] md:text-[18px] lg:text-[20px] font-medium lg:font-semibold py-[17px] px-[20px] lg:py-[12px] cursor-pointer transition transition-fast', { 'bg-neutral-100 text-brand-electric-blue': index === highlightedIndex }]"            >              {{ industry.name }}            </li>          </ul>        </div>      </div>      <div class="mobile-advance-step fixed bottom-0 top-auto left-0 right-0 z-[2] mt-[40px] py-[16px] bg-white/95 w-full bottom-button advance-button flex flex-col justify-center items-center lg:hidden">        <button            @click.prevent="advanceCreationStep"            class="advance-button w-full max-w-fit mx-auto relative bg-brand-200 text-white font-bold flex flex-row items-center justify-between uppercase gap-[12px] py-[16px] px-[17px] transition transition-fast"            :class="isValidSelection ? 'opacity-100 pointer-events-auto' : 'opacity-50 pointer-events-none'">          Continue          <svg width="14" height="12" viewBox="0 0 14 12" fill="none" xmlns="http://www.w3.org/2000/svg">            <path fill-rule="evenodd" clip-rule="evenodd" d="M7.34171 0.508457C7.79732 0.0528452 8.53601 0.0528451 8.99162 0.508457L13.6583 5.17512C14.1139 5.63074 14.1139 6.36943 13.6583 6.82504L8.99162 11.4917C8.53601 11.9473 7.79732 11.9473 7.34171 11.4917C6.8861 11.0361 6.8861 10.2974 7.34171 9.84179L10.0168 7.16675L1.16667 7.16675C0.522335 7.16675 -2.81646e-08 6.64441 0 6.00008C2.81647e-08 5.35575 0.522335 4.83342 1.16667 4.83342H10.0168L7.34171 2.15837C6.8861 1.70276 6.8861 0.964069 7.34171 0.508457Z" fill="white"/>          </svg>        </button>      </div>    </div>    <div class="bottom-content w-full relative lg:mt-[290px] hidden lg:block">      <frequently-asked-questions></frequently-asked-questions>      <contact-support-form></contact-support-form>    </div>  </section></template><style scoped lang="scss">  /* Optional styling for dropdown */  .dropdown-list {    @media only screen and (min-width: 1024px) {      box-shadow: 0 5px 12px 3px rgba(0,0,0, .10);    }  }  .dropdown-item:hover {    background-color: #e2e8f0; /* Replace with your brand color */  }  .industry-search-input {    transition: border-color 0.3s, box-shadow 0.3s; // Smooth transition for focus effect    &.focused {      padding-top: 32px;      padding-bottom: 17px;    }    &:focus,    &:active {      outline: none;      padding-top: 32px;      padding-bottom: 17px;    }  }  .search-industry-input-field {    position: relative;    &.focused label {      top: 10px; // Move label to the top when focused      transition: color 0.3s, top 0.3s;    }  }</style>