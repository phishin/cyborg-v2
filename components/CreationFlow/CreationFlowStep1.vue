<script setup>import { ref, computed, watch, onMounted, onUnmounted } from "vue";import { useLogoStore } from '~/stores/logoStores.js'import FrequentlyAskedQuestions from "../homepage/FrequentlyAskedQuestions.vue";import ContactSupportForm from "../homepage/ContactSupportForm.vue";import Fuse from "fuse.js";import industryData from "./all-industries.json";import BottomCreationFlowContent from "~/components/CreationFlow/BottomCreationFlowContent.vue";// Use the store directlyconst logoStore = useLogoStore();// Bind global selectedIndustry via a computed getter/setter.const selectedIndustry = computed({  get: () => logoStore.selectedIndustry,  set: (val) => { logoStore.selectedIndustry = val; }});// Use a local ref for the query so that typing/deleting is managed locally.const query = ref(selectedIndustry.value ? selectedIndustry.value.name : "");// Local copies of the industry data and search resultsconst industries = ref(industryData);const results = ref([]);// Control dropdown visibility and keyboard navigationconst showDropdown = ref(false);const highlightedIndex = ref(-1);const focusedInputField = ref(false);const inputRef = ref(null); // to programmatically blur the input// Initialize Fuse.js with the industries listconst fuse = new Fuse(industries.value, { keys: ["name"], threshold: 0.3 });// The search function: update results based on the current query.// If the query doesn't match an industry exactly, clear the global selection.const search = () => {  const q = query.value.trim();  if (q) {    results.value = fuse.search(q).map(result => result.item);    // If the entered text doesn't exactly match any industry name, clear selection.    if (!industries.value.some(ind => ind.name.toLowerCase() === q.toLowerCase())) {      selectedIndustry.value = null;    }  } else {    results.value = industries.value;    // Clear the global selection if nothing is entered.    selectedIndustry.value = null;  }};// When the user clicks on an industry from the dropdown,// update the global selection, update the query, hide the dropdown,// and then blur the input so it appears reset.const selectIndustry = (industry) => {  selectedIndustry.value = industry;  // Update global state  query.value = industry.name;        // Reflect the selection locally  showDropdown.value = false;         // Hide the dropdown  highlightedIndex.value = -1;  // Blur the input so it appears unfocused (simulate default state)  if (inputRef.value) {    inputRef.value.blur();  }  focusedInputField.value = false;};// When the input is focused, show the dropdown and run search.const handleFocus = () => {  focusedInputField.value = true;  showDropdown.value = true;  search();};// When the input loses focus, hide the dropdown after a short delayconst handleBlur = () => {  focusedInputField.value = false;  setTimeout(() => {    showDropdown.value = false;  }, 200);};// Computed: if the input contains any text.const isFieldPopulated = computed(() => query.value.trim().length > 0);// Computed: a valid selection exists if a global industry is selected.const isValidSelection = computed(() => !!selectedIndustry.value);// Allow keyboard navigation for the dropdown.const handleKeyDown = (event) => {  if (!showDropdown.value || results.value.length === 0) return;  if (event.key === "ArrowDown") {    event.preventDefault();    highlightedIndex.value = (highlightedIndex.value + 1) % results.value.length;  } else if (event.key === "ArrowUp") {    event.preventDefault();    highlightedIndex.value = (highlightedIndex.value - 1 + results.value.length) % results.value.length;  } else if (event.key === "Enter" && highlightedIndex.value >= 0) {    event.preventDefault();    selectIndustry(results.value[highlightedIndex.value]);  }};// Watch query changes in real time.watch(query, () => {  search();});// When the global selectedIndustry changes, update the query// only if the input is not currently focused.watch(() => logoStore.selectedIndustry, (newIndustry) => {  if (!focusedInputField.value) {    query.value = newIndustry ? newIndustry.name : "";  }});// Also, clear the global selection if the query is empty.watch(query, (newVal) => {  if (!newVal.trim()) {    selectedIndustry.value = null;  }});// Set up keyboard event listeneronMounted(() => {  results.value = industries.value;  window.addEventListener("keydown", handleKeyDown);});onUnmounted(() => {  window.removeEventListener("keydown", handleKeyDown);});// Step navigation (advance/back) remains unchanged:const advanceCreationStep = () => {  logoStore.nextStep();};const previousCreationStep = () => {  // Implement as needed};</script><template>  <section class="creation-step step-1 w-full relative flex flex-col justify-start items-start font-primary mt-[69px] md:mt-[80px] lg:mt-[95px]">    <div class="creation-flow-content w-full h-full relative flex flex-col justify-start items-start">      <!-- Desktop Previous/Next Buttons -->      <div class="top-desktop-buttons relative flex-row justify-between hidden lg:flex pt-[66px] mx-auto w-[90%] site-container">        <a href="/" class="previous-step-button flex flex-row gap-[12px] py-[25px] px-[24px] max-w-fit border-[4px] border-black uppercase font-black text-[18px] leading-[2px] tracking-[1px] text-neutral-700 items-center h-[68px] transition transition-fast hover:bg-black hover:text-white group">          <!-- SVG icon for back -->          Back One Step        </a>        <button @click="advanceCreationStep"                class="next-step-button flex flex-row gap-[12px] py-[25px] px-[24px] max-w-fit uppercase font-black text-[18px] leading-[1] tracking-[2px] text-white bg-brand-200 items-center h-[68px] transition transition-fast"                :class="isValidSelection ? 'opacity-100 pointer-events-auto' : 'opacity-50 pointer-events-none'">          Continue          <!-- SVG icon for continue -->        </button>      </div>      <!-- Step One Content -->      <div class="step-content site-container relative w-full h-full">        <div class="top-step-titles bg-white/90 w-full pb-[15px] pt-[35px] lg:pt-[64px] relative top-0 z-[2]">          <h1 class="block relative text-black font-bold text-[20px] md:text-[26px] lg:text-[32px] leading-[1.2]">            Select your industry          </h1>          <h2 class="block relative text-black font-normal text-[18px] md:text-[20px] lg:text-[24px] pt-[20px] leading-[1.35]">            This will help create a more custom look for your industry.          </h2>        </div>        <!-- Industry Selection -->        <div class="search-industry relative w-full mt-[24px] md:mt-[35px] lg:mt-[50px] mb-auto">          <div class="search-industry-input-field w-full relative block"               :class="{ focused: focusedInputField || isFieldPopulated || isValidSelection }">            <label for="search-industry" class="absolute top-[22px] left-[18px] text-[12px] text-black font-normal transition transition-fast">              Select Specialty (e.g., Plumbing, Electrical)            </label>            <input id="search-industry"                   ref="inputRef"                   type="text"                   v-model="query"                   @input="search"                   @focus="handleFocus"                   @blur="handleBlur"                   :class="{'valid-selection': isValidSelection}"                   class="industry-search-input border-[3px] border-neutral-200 block w-full text-black font-medium min-h-[64px] max-h-[64px] px-[18px] transition transition-fast focus:border-brand-electric-blue active:border-brand-electric-blue"/>          </div>          <!-- Dropdown for search results -->          <ul v-if="showDropdown && results.length" class="dropdown-list absolute w-full border border-neutral-200 bg-white max-h-[200px] md:max-h-[290px] lg:max-h-[385px] overflow-y-auto z-10">            <li v-for="(industry, index) in results" :key="industry.id"                @mousedown.prevent="selectIndustry(industry)"                :class="['dropdown-item text-black text-[16px] md:text-[18px] lg:text-[20px] font-medium lg:font-semibold py-[17px] px-[20px] lg:py-[12px] cursor-pointer transition transition-fast', { 'bg-neutral-100 text-brand-electric-blue': index === highlightedIndex }]">              {{ industry.name }}            </li>          </ul>        </div>      </div>      <!-- Mobile Advance Button -->      <div class="mobile-advance-step fixed bottom-0 left-0 right-0 z-[2] mt-[40px] py-[16px] bg-white/95 w-full flex flex-col justify-center items-center lg:hidden">        <button @click.prevent="advanceCreationStep"                class="advance-button w-full max-w-fit mx-auto relative bg-brand-200 text-white font-bold flex flex-row items-center justify-between uppercase gap-[12px] py-[16px] px-[17px] transition transition-fast"                :class="isValidSelection ? 'opacity-100 pointer-events-auto' : 'opacity-50 pointer-events-none'">          Continue          <!-- SVG icon for continue -->        </button>      </div>    </div>    <bottom-creation-flow-content />  </section></template><style scoped lang="scss">/* Dropdown and input styling */.dropdown-list {  @media only screen and (min-width: 1024px) {    box-shadow: 0 5px 12px 3px rgba(0, 0, 0, 0.10);  }}.dropdown-item:hover {  background-color: #e2e8f0;}.industry-search-input {  transition: border-color 0.3s, box-shadow 0.3s;  &.focused,  &.valid-selection {    padding-top: 32px;    padding-bottom: 17px;  }  &:focus,  &:active {    outline: none;    padding-top: 32px;    padding-bottom: 17px;  }}.search-industry-input-field {  position: relative;  &.focused label {    top: 10px;    transition: color 0.3s, top 0.3s;  }}</style>