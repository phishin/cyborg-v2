<script setup>import {ref, onMounted, computed} from "vue";import SaveLogoModal from "~/components/CreationFlow/SaveLogoModal.vue";import { useLogoStore } from '~/stores/logoStores';const logoStore = useLogoStore();import { useStripeCheckoutStore } from '~/stores/stripeCheckoutStore';const stripeCheckout = useStripeCheckoutStore();// STRIPE CHECKOUT// helper to start the checkout flowfunction handleBuy() {  stripeCheckout.checkout()}// value of selected logo id to pass through to parent componentconst selectedLogoID = computed({  get: () => logoStore.selectedLogoID,  set: (val) => { logoStore.selectedLogoID = val; }});// Array of logo and watermark image sourcesconst matchingLogoImages = [  {    logo: "/assets/img/sample-logos/sample-logo-1.png",    watermark: "/assets/img/cyborg-logo-watermark.png",    logoID: "logoV1"  },  {    logo: "/assets/img/sample-logos/sample-logo-2.png",    watermark: "/assets/img/cyborg-logo-watermark.png",    logoID: "logoV2"  },  {    logo: "/assets/img/sample-logos/sample-logo-3.png",    watermark: "/assets/img/cyborg-logo-watermark.png",    logoID: "logoV3"  },  {    logo: "/assets/img/sample-logos/sample-logo-1.png",    watermark: "/assets/img/cyborg-logo-watermark.png",    logoID: "logoV4"  },  {    logo: "/assets/img/sample-logos/sample-logo-2.png",    watermark: "/assets/img/cyborg-logo-watermark.png",    logoID: "logoV5"  },  {    logo: "/assets/img/sample-logos/sample-logo-3.png",    watermark: "/assets/img/cyborg-logo-watermark.png",    logoID: "logoV6"  },];// Reactive array to store combined image URLsconst combinedImages = ref([]);// Fixed dimensions for `.logo-item`const logoItemWidth = 333; // Matches aspect ratio widthconst logoItemHeight = 301; // Matches aspect ratio height// Generate combined images for all logo-watermark pairsconst generateCombinedImages = async () => {  const promises = matchingLogoImages.map(({logo, watermark}) =>      createCombinedImage(logo, watermark)  );  combinedImages.value = await Promise.all(promises);};// Create a combined image with canvasconst createCombinedImage = async (logoSrc, watermarkSrc) => {  const canvas = document.createElement("canvas"); // Create a temporary canvas  const ctx = canvas.getContext("2d");  // Set canvas size to match `.logo-item`  canvas.width = logoItemWidth;  canvas.height = logoItemHeight;  // Load images  const [logoImage, watermarkImage] = await Promise.all([    loadImage(logoSrc),    loadImage(watermarkSrc),  ]);  // Draw watermark as full background  ctx.drawImage(watermarkImage, 0, 0, canvas.width, canvas.height);  // Calculate logo dimensions and position  const logoMaxWidth = canvas.width;  const logoMaxHeight = canvas.height;  const logoWidth = Math.min(logoImage.width, logoMaxWidth);  const logoHeight = Math.min(logoImage.height, logoMaxHeight);  const logoX = (canvas.width - logoWidth) / 2; // Center horizontally  const logoY = (canvas.height - logoHeight) / 2; // Center vertically  // Draw logo on top of watermark  ctx.drawImage(logoImage, logoX, logoY, logoWidth, logoHeight);  // Convert canvas to an image URL  return canvas.toDataURL("image/png");};// Helper function to load an imageconst loadImage = (src) =>    new Promise((resolve, reject) => {      const img = new Image();      img.crossOrigin = "anonymous"; // Handle CORS issues if images are hosted externally      img.onload = () => resolve(img);      img.onerror = reject;      img.src = src;    });// Handle logo click to show edit buttonsconst handleLogoClick = (logoID) => {  selectedLogoID.value = logoID;  console.log("Selected logo ID:", selectedLogoID.value);};// Handle edit button clickconst handleEditLogoClick = (logoID) => {  logoStore.openLogoEditor(logoID);};// Save current logo state into Firestore via Pinia actionasync function handleSaveLogo() {  try {    const id = await logoStore.saveLogo();    console.log('Saved logo with id', id);    alert('Logo saved! ID: ' + id);  } catch (err) {    console.error('Failed to save logo', err);    alert('Error saving logo: ' + err.message);  }}// Generate combined images on component mountonMounted(() => {  generateCombinedImages();});</script><template>  <div class="logo-results w-full relative block pt-[30px] md:pt-[50px] lg:pt-[85px]">    <div        class="logo-results-wrapper w-full grid grid-cols-1 sm:grid-cols-2 sm:gap-x-[20px] lg:grid-cols-[repeat(2,min-content)] xl:grid-cols-[repeat(3,min-content)] justify-items-center justify-center md:justify-items-start md:justify-start gap-x-[20px] gap-y-[30px] "    >      <!-- Render combined images -->      <div          v-for="(generatedLogoImage, index) in combinedImages"          :key="index"          :class="[          'logo-item font-primary w-full h-full min-w-auto max-w-[340px] sm:min-w-full sm:max-w-[50%] lg:w-full lg:h-full lg:max-h-[initial] lg:max-w-full lg:min-w-[320px] xl:min-w-[350px] relative transition-all duration-200 block aspect-[333/301] cursor-pointer',          matchingLogoImages[index].logoID === selectedLogoID ? 'logo-selected' : ''        ]"          @click="handleLogoClick(matchingLogoImages[index].logoID)"      >        <div            class="logo-item-wrapper w-full h-full flex flex-col justify-center items-center py-[58px] px-[30px] md:px-[45px]  transition-all duration-200 border-[6px] bg-white overflow-hidden relative"            :class="[              matchingLogoImages[index].logoID === selectedLogoID                ? 'border-brand-300'                : 'border-neutral-200'            ]"            style="background-repeat: no-repeat; background-size: contain; background-position: center center;"            :style="{ backgroundImage: `url(${generatedLogoImage})`}"        >          <div class="logo-item-buttons w-full absolute bottom-[12px] left-0 right-0 flex flex-row justify-center px-[12px] transition-all duration-300"               :class="[              matchingLogoImages[index].logoID === selectedLogoID                ? 'opacity-1 pointer-events-auto bottom-0'                : 'opacity-0 pointer-events-none bottom-[-10px]'            ]"          >            <div class="button-item w-auto flex-1 relative max-w-fit self-stretch">              <button                  @click.stop="handleEditLogoClick(matchingLogoImages[index].logoID)"                  class="edit-button w-auto h-full border-[3px] border-black bg-white text-black font-black uppercase text-[13px] py-[12px] px-[30px] lg:px-[25px] xl:px-[30px] text-center leading-[1.1] tracking-[2px] xl:tracking-[3px] transition transition-fast hover:bg-brand-300 hover:text-white hover:border-brand-300">                Edit              </button>            </div>            <!-- buy -->            <div class="button-item w-auto flex-1 px-[12px] relative max-w-fit self-stretch">              <button                  class="buy-button w-auto h-full bg-black text-white font-black uppercase text-[13px] py-[12px] px-[15px] lg:px-[20px] xl:px-[22px] xxl:px-[20px] text-center leading-[1.1] tracking-[2px] xl:tracking-[3px] transition transition-fast hover:bg-brand-300 hover:text-white"                  @click.stop.prevent="handleBuy()"                  :disabled="stripeCheckout.loading"              >                <!-- loader when stripeCheckout.loading -->                <svg                    v-if="stripeCheckout.loading"                    xmlns="http://www.w3.org/2000/svg"                    class="inline-block w-[20px] h-[20px] animate-spin"                    viewBox="0 0 50 50"                >                  <circle                      class="background stroke-brand-50"                      cx="25" cy="25" r="20"                      fill="none" stroke-width="8"                  />                  <circle                      class="path stroke-[#00AA8B]"                      cx="25" cy="25" r="20"                      fill="none" stroke-width="8"                      stroke-linecap="round"                      stroke-dasharray="31.4 31.4"                      stroke-dashoffset="0"                  />                </svg>                <!-- text when not loading -->                <span v-else>BUY $99</span>              </button>            </div>            <!-- save -->            <div class="button-item w-auto flex-1 relative max-w-fit self-stretch">              <button class="save-button w-auto h-full border-2 border-black font-black uppercase text-[13px] py-[12px] px-[9px] flex flex-col justify-center items-center tracking-[2px] xl:tracking-[3px] group transition transition-fast hover:bg-brand-300 hover:border-brand-300" @click.stop.prevent="handleSaveLogo();">                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">                  <path class="group-hover:fill-white group-hover:stroke-white transition transition-fast" d="M12 21.0417C12 21.0417 3.25 16.395 3.25 9.375C3.25 6.95875 5.29033 5 7.80735 5C9.68921 5 11.3047 6.095 12 7.6575C12.6953 6.095 14.3108 5 16.1927 5C18.7097 5 20.75 6.95875 20.75 9.375C20.75 16.395 12 21.0417 12 21.0417Z"                        stroke="black"                        stroke-width="1.5"                        stroke-linecap="round"                        stroke-linejoin="round"/>                </svg>              </button>            </div>          </div>        </div>      </div>    </div>  </div></template><style scoped lang="scss">.logo-results {  .logo-item {    @media only screen and (min-width: 1280px) {      &:nth-child(3n) {        padding-right: 0;      }    }  }}.logo-item {  aspect-ratio: 333 / 301; /* Maintain aspect ratio */}</style>