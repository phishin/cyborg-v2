// /stores/logoStores.jsimport { defineStore } from 'pinia';import { doc, setDoc, getDocs, collection, query, where } from 'firebase/firestore';// @ts-ignoreexport const useLogoStore = defineStore('logoStorageData', {    state: () => ({        creationStep: 1,        logoBuilder: false,        companyName: '',        createMyLogoIsActive: false,        selectedIndustry: null,        selectedLogoStyle: null,        fullBusinessName: '',        businessNameInitials: '',        selectedSuffix: null,        businessCategory: '',        sloganOrTagline: '',        sloganOrTaglinePresent: false,        preferredSymbolsOrStyles: [],        selectedFontStyles: [],        selectedColorStyles: [],        logoGenerationLoading: false,        originalLogoFieldValues: [],        selectedLogoID: '',        logoEditorSelected: false,        logoEditorLogoID: '',        showSaveLogoModal: false,        // History arrays for        undoHistory: [],        redoHistory: [],        savedLogos: []    }),    getters: {        savedLogoCount: (state) => state.savedLogos.length    },    actions: {        activateCreateMyLogo() {            this.createMyLogoIsActive = true;        },        triggerLogoGeneration() {            this.logoGenerationLoading = true;            this.creationStep = 0; // Reset step if needed            setTimeout(() => {                this.logoGenerationLoading = false;                this.logoBuilder = true;            }, 1000);        },        nextStep() {            if (this.creationStep < 7) {                this.creationStep++;            }        },        previousStep() {            if (this.creationStep > 1) {                this.creationStep--;            }        },        // Push undo        pushUndoHistory(stateSnapshot, maxHistory = 15) {            this.undoHistory.push(JSON.parse(JSON.stringify(stateSnapshot)));            if (this.undoHistory.length > maxHistory) {                this.undoHistory.shift();            }            this.redoHistory = [];        },      // push redo        pushRedoHistory(stateSnapshot, maxHistory = 15) {            this.redoHistory.push(JSON.parse(JSON.stringify(stateSnapshot)));            if (this.redoHistory.length > maxHistory) {                this.redoHistory.shift();            }        },        popUndoHistory() {            return this.undoHistory.pop();        },        popRedoHistory() {            return this.redoHistory.pop();        },        // Restore a state        restoreState(state) {            this.selectedIndustry = state.selectedIndustry ? { ...state.selectedIndustry } : null;            this.selectedLogoStyle = state.selectedLogoStyle;            this.selectedSuffix = state.selectedSuffix;            this.sloganOrTagline = state.sloganOrTagline;            this.preferredSymbolsOrStyles = [...state.preferredSymbolsOrStyles];            this.selectedColorStyles = [...state.selectedColorStyles];            this.fullBusinessName = state.fullBusinessName;            this.businessNameInitials = state.businessNameInitials;            this.businessCategory = state.businessCategory;        },        // logo editor        openLogoEditor(logoID) {            this.selectedLogoID     = logoID;            this.logoEditorSelected = true;        },        closeLogoEditor() {            this.logoEditorSelected = false;            this.selectedLogoID     = '';        },        // ─── FIRESTORE SAVING / LOADING ──────────────────────────────────────────        async saveLogo() {            console.log('save logo function from logoStores pinia')            const nuxtApp = useNuxtApp()            const auth     = nuxtApp.$firebase.auth            const db       = nuxtApp.$firebase.firebaseDatabase            const user     = auth.currentUser            // 1) If not logged in, pop your modal and bail out            if (!user) {                this.showSaveLogoModal = true                return null            }            // 2) Build a plain JS snapshot of only the JSON-friendly bits            const stateToSave = {                creationStep: this.creationStep,                logoBuilder: this.logoBuilder,                companyName: this.companyName,                createMyLogoIsActive: this.createMyLogoIsActive,                fullBusinessName: this.fullBusinessName,                businessNameInitials: this.businessNameInitials,                businessCategory: this.businessCategory,                sloganOrTagline: this.sloganOrTagline,                sloganOrTaglinePresent: this.sloganOrTaglinePresent,                selectedIndustry: this.selectedIndustry  ? JSON.parse(JSON.stringify(this.selectedIndustry)) : null,                selectedLogoStyle: this.selectedLogoStyle,                selectedSuffix: this.selectedSuffix,                preferredSymbolsOrStyles: [...this.preferredSymbolsOrStyles],                selectedFontStyles: [...this.selectedFontStyles],                selectedColorStyles: [...this.selectedColorStyles],                logoGenerationLoading: this.logoGenerationLoading,                selectedLogoID: this.selectedLogoID,                logoEditorSelected: this.logoEditorSelected,                logoEditorLogoID: this.logoEditorLogoID            }            const payload = {                userId:    user.uid,                createdAt: new Date(),                state:     stateToSave            }            // 3) Firestore write            const id = `${user.uid}_${Date.now()}`            await setDoc(doc(db, 'logos', id), payload)            return id        },        openSaveLogoModal() {            this.showSaveLogoModal = true;        },        closeSaveLogoModal() {            this.showSaveLogoModal = false;        },        async fetchSavedLogos() {            const nuxtApp = useNuxtApp();            const auth = nuxtApp.$firebase.auth;            const db = nuxtApp.$firebase.firebaseDatabase;            const user = auth.currentUser;            if (!user) {                this.savedLogos = [];                return;            }            const q = query(collection(db, 'logos'), where('userId', '==', user.uid));            const snap = await getDocs(q);            this.savedLogos = snap.docs.map(d => ({ id: d.id, ...d.data() }));        },        restoreLogo(saved) {            this.$patch(saved.state);        }    },});